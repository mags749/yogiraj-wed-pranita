!function(t){"use strict";function e(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function i(t,i){this.container=t,this.options=e({},this.options),e(this.options,i),this._init()}function s(t,e){t.style.WebkitTransform=e,t.style.msTransform=e,t.style.transform=e}var n=!!getStyleProperty("perspective"),a=Modernizr.csstransitions,o={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},r=o[Modernizr.prefixed("transition")];i.prototype.options={distDragBack:200,distDragMax:450,onUpdateStack:function(){return!1}},i.prototype._init=function(){this.items=[].slice.call(this.container.children),this.itemsCount=this.items.length,this.current=0,this._setStackStyle(),this.itemsCount>1&&(this._initDragg(),this._initEvents())},i.prototype._initEvents=function(){var t=this;this.draggie.on("dragStart",function(e,i,s){t._onDragStart(e,i,s)}),this.draggie.on("dragMove",function(e,i,s){t._onDragMove(e,i,s)}),this.draggie.on("dragEnd",function(e,i,s){t._onDragEnd(e,i,s)})},i.prototype._setStackStyle=function(){var t=this._firstItem(),e=this._secondItem(),i=this._thirdItem();t&&(t.style.opacity=1,t.style.zIndex=4,s(t,n?"translate3d(0,0,0)":"translate(0,0)")),e&&(e.style.opacity=1,e.style.zIndex=3,s(e,n?"translate3d(0,0,-60px)":"translate(0,0)")),i&&(i.style.opacity=1,i.style.zIndex=2,s(i,n?"translate3d(0,0,-120px)":"translate(0,0)"))},i.prototype._moveAway=function(t){this._disableDragg(),classie.add(t.element,"animate");var e=this._getTranslateVal(t);s(t.element,n?"translate3d("+e.x+"px,"+e.y+"px, 0px)":"translate("+e.x+"px,"+e.y+"px)"),t.element.style.opacity=0;var i=this._secondItem(),o=this._thirdItem();i&&(classie.add(i,"move-back"),classie.add(i,"animate"),s(i,n?"translate3d(0,0,-60px)":"translate(0,0)")),o&&(classie.add(o,"move-back"),classie.add(o,"animate"),s(o,n?"translate3d(0,0,-120px)":"translate(0,0)"));var c=this,p=function(){t.element.removeEventListener(r,p),s(t.element,n?"translate3d(0,0,-180px)":"translate(0,0,0)"),t.element.style.left=t.element.style.top="0px",t.element.style.zIndex=-1,classie.remove(t.element,"animate"),c.current=c.current<c.itemsCount-1?c.current+1:0;var e=c._firstItem(),i=c._secondItem(),a=c._thirdItem();classie.remove(e,"move-back"),i&&classie.remove(i,"move-back"),a&&classie.remove(a,"move-back"),setTimeout(function(){classie.add(c._lastItem(),"animate"),c._setStackStyle()},25),c._initDragg(),c._initEvents(),c.options.onUpdateStack(c.current)};a?t.element.addEventListener(r,p):p.call()},i.prototype._moveBack=function(t){var e=this._secondItem(),i=this._thirdItem();classie.add(t.element,"move-back"),classie.add(t.element,"animate"),s(t.element,n?"translate3d(0,0,0)":"translate(0,0)"),t.element.style.left="0px",t.element.style.top="0px",e&&(classie.add(e,"move-back"),classie.add(e,"animate"),s(e,n?"translate3d(0,0,-60px)":"translate(0,0)")),i&&(classie.add(i,"move-back"),classie.add(i,"animate"),s(i,n?"translate3d(0,0,-120px)":"translate(0,0)"))},i.prototype._onDragStart=function(t){var e=this._secondItem(),i=this._thirdItem();classie.remove(t.element,"move-back"),classie.remove(t.element,"animate"),e&&(classie.remove(e,"move-back"),classie.remove(e,"animate")),i&&(classie.remove(i,"move-back"),classie.remove(i,"animate"))},i.prototype._onDragMove=function(t){if(this._outOfBounds(t))this._moveAway(t);else{var e=this._secondItem(),i=this._thirdItem();e&&s(e,n?"translate3d("+.6*t.position.x+"px,"+.6*t.position.y+"px, -60px)":"translate("+.6*t.position.x+"px,"+.6*t.position.y+"px)"),i&&s(i,n?"translate3d("+.3*t.position.x+"px,"+.3*t.position.y+"px, -120px)":"translate("+.3*t.position.x+"px,"+.3*t.position.y+"px)")}},i.prototype._onDragEnd=function(t){this._outOfBounds(t)||(this._outOfSight(t)?this._moveAway(t):this._moveBack(t))},i.prototype._initDragg=function(){this.draggie=new Draggabilly(this.items[this.current])},i.prototype._disableDragg=function(){this.draggie.disable()},i.prototype._outOfBounds=function(t){return Math.abs(t.position.x)>this.options.distDragMax||Math.abs(t.position.y)>this.options.distDragMax},i.prototype._outOfSight=function(t){return Math.abs(t.position.x)>this.options.distDragBack||Math.abs(t.position.y)>this.options.distDragBack},i.prototype._getTranslateVal=function(t){var e=Math.sqrt(Math.pow(t.position.x,2)+Math.pow(t.position.y,2)),i=Math.asin(Math.abs(t.position.y)/e)/(Math.PI/180),s=e+this.options.distDragBack,n=Math.cos(i*(Math.PI/180))*s,a=Math.sin(i*(Math.PI/180))*s,o=n-Math.abs(t.position.x),r=a-Math.abs(t.position.y);return{x:t.position.x>0?o:-1*o,y:t.position.y>0?r:-1*r}},i.prototype._firstItem=function(){return this.items[this.current]},i.prototype._secondItem=function(){return this.itemsCount<2?void 0:this.current+1<this.itemsCount?this.items[this.current+1]:this.items[Math.abs(this.itemsCount-(this.current+1))]},i.prototype._thirdItem=function(){return this.itemsCount<3?void 0:this.current+2<this.itemsCount?this.items[this.current+2]:this.items[Math.abs(this.itemsCount-(this.current+2))]},i.prototype._lastItem=function(){return this.itemsCount<3?this._secondItem():this._thirdItem()},t.ElastiStack=i}(window);
